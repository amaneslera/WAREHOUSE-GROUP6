<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warehouse Manager - Quick Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <h1><i class="fas fa-warehouse"></i> Warehouse Manager - API Test</h1>
            <hr>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="card mb-3">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Warehouses</h5>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-primary" onclick="testWarehouses()">
                                <i class="fas fa-sync"></i> Load Warehouses
                            </button>
                            <div id="warehouseResult" class="mt-3"></div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card mb-3">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">Approval Stats</h5>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-info" onclick="testStats()">
                                <i class="fas fa-sync"></i> Load Stats
                            </button>
                            <div id="statsResult" class="mt-3"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="card mb-3">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0">Pending Approvals</h5>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-warning" onclick="testPending()">
                                <i class="fas fa-sync"></i> Load Pending
                            </button>
                            <div id="pendingResult" class="mt-3"></div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card mb-3">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">Dashboard Auth Status</h5>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-success" onclick="testAuth()">
                                <i class="fas fa-check"></i> Check Auth
                            </button>
                            <div id="authResult" class="mt-3"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="alert alert-info mt-4">
                <h5>Test Users</h5>
                <p><strong>Manager:</strong> manager@example.com / manager123</p>
                <p><strong>Staff:</strong> staff@example.com / staff123</p>
                <p class="mb-0"><strong>Dashboard URL:</strong> <a href="http://localhost/WAREHOUSE-GROUP6/dashboard/manager">View Manager Dashboard</a></p>
            </div>
        </div>
    </div>
</div>

<script>
const API_BASE = 'http://localhost/WAREHOUSE-GROUP6/api';

async function testWarehouses() {
    try {
        const result = document.getElementById('warehouseResult');
        result.innerHTML = '<div class="spinner-border"></div> Loading...';
        
        const response = await fetch(`${API_BASE}/warehouses`);
        const data = await response.json();
        
        if (data.status === 'success') {
            let html = '<div class="alert alert-success">' + data.count + ' warehouses found</div>';
            html += '<div class="table-responsive"><table class="table table-sm"><thead><tr><th>Name</th><th>Location</th><th>Items</th><th>Value</th></tr></thead><tbody>';
            data.data.forEach(w => {
                html += `<tr><td>${w.warehouse_name}</td><td>${w.location}</td><td>${w.item_count}</td><td>$${parseFloat(w.total_value).toFixed(2)}</td></tr>`;
            });
            html += '</tbody></table></div>';
            result.innerHTML = html;
        } else {
            result.innerHTML = '<div class="alert alert-danger">Error: ' + JSON.stringify(data) + '</div>';
        }
    } catch (error) {
        document.getElementById('warehouseResult').innerHTML = '<div class="alert alert-danger">Error: ' + error.message + '</div>';
    }
}

async function testStats() {
    try {
        const result = document.getElementById('statsResult');
        result.innerHTML = '<div class="spinner-border"></div> Loading...';
        
        const response = await fetch(`${API_BASE}/approvals/stats`);
        const data = await response.json();
        
        if (response.status === 401) {
            result.innerHTML = '<div class="alert alert-warning">Need authentication (401). Login to manager account first.</div>';
        } else if (data.status === 'success') {
            result.innerHTML = '<div class="alert alert-success"><strong>Approval Stats:</strong><br>' +
                'Pending: ' + data.data.pending + '<br>' +
                'Approved: ' + data.data.approved + '<br>' +
                'Rejected: ' + data.data.rejected + '</div>';
        } else {
            result.innerHTML = '<div class="alert alert-danger">Error: ' + JSON.stringify(data) + '</div>';
        }
    } catch (error) {
        document.getElementById('statsResult').innerHTML = '<div class="alert alert-danger">Error: ' + error.message + '</div>';
    }
}

async function testPending() {
    try {
        const result = document.getElementById('pendingResult');
        result.innerHTML = '<div class="spinner-border"></div> Loading...';
        
        const response = await fetch(`${API_BASE}/approvals/pending`);
        const data = await response.json();
        
        if (response.status === 401) {
            result.innerHTML = '<div class="alert alert-warning">Need authentication (401). Login to manager account first.</div>';
        } else if (data.status === 'success') {
            if (data.count === 0) {
                result.innerHTML = '<div class="alert alert-success">No pending approvals</div>';
            } else {
                let html = '<div class="alert alert-warning">' + data.count + ' pending movements</div>';
                html += '<div class="list-group">';
                data.data.forEach(m => {
                    html += `<div class="list-group-item"><strong>${m.item_name}</strong> - ${m.quantity} units (${m.movement_type.toUpperCase()})</div>`;
                });
                html += '</div>';
                result.innerHTML = html;
            }
        } else {
            result.innerHTML = '<div class="alert alert-danger">Error: ' + JSON.stringify(data) + '</div>';
        }
    } catch (error) {
        document.getElementById('pendingResult').innerHTML = '<div class="alert alert-danger">Error: ' + error.message + '</div>';
    }
}

async function testAuth() {
    try {
        const result = document.getElementById('authResult');
        result.innerHTML = '<div class="spinner-border"></div> Checking...';
        
        const response = await fetch(`${API_BASE}/warehouses`);
        const data = await response.json();
        
        if (response.status === 200 && data.status === 'success') {
            result.innerHTML = '<div class="alert alert-success">âœ“ Public API endpoints working</div>';
        } else {
            result.innerHTML = '<div class="alert alert-info">API status: ' + response.status + '</div>';
        }
    } catch (error) {
        document.getElementById('authResult').innerHTML = '<div class="alert alert-danger">Error: ' + error.message + '</div>';
    }
}

// Load all on page load
window.onload = () => {
    testWarehouses();
    testAuth();
};
</script>
</body>
</html>
